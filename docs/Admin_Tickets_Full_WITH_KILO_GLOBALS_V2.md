# 工单指令库（管理端 Admin）全量版：内容生产 → 发布 → SEO/GEO → Web 可见

## 你每次复制给 Kilo 的标准格式（强烈建议照抄）

> 把“工单正文”粘贴在最后。Kilo 看到这段前缀会更稳：

```text
/code
执行工单：<工单编号>：<工单标题>

重要说明：
- 你无法替我在网页控制台创建云资源（如 Supabase 项目）；需要时请在 docs 中给出“我手动操作”的步骤。
- 严格遵守本工单的【允许改动】白名单与【禁止改动】黑名单。
- 先输出：计划（步骤）+ 将新增/修改的文件清单 + 每个文件将写入的关键内容（摘要或片段）。
- 我确认后你再真正写入文件。
- 完成后给我：验收步骤（我在终端/浏览器如何验证）+ 建议 commit message。
```

---

## 全局约束（每张卡都默认继承）

- **UI 不推倒**：除非工单明确允许，否则不重构页面结构、不更换组件库、不大改样式。
- **小步提交**：每张卡完成后必须能 `npm/pnpm run dev`；`git status` 干净。
- **安全**：禁止把任何密钥写进仓库；`.env.local` 永远不提交。
- **优先 Server Actions**：优先使用 `actions/**` + Server Components 读数据；交互组件保持 Client。
- **数据隔离**：所有用户数据表必须有 `user_id` 并启用 RLS。
- **文档同步**：涉及新增表/动作/路由，需更新 `docs/FEATURE_COVERAGE.md`（若存在）或在 `docs/project-status.md` 记录。

---


> 目标：Admin 一旦发布内容，Web 必须能立刻读取（published），并且 SEO/GEO 字段可用于生成结构化数据与 sitemap。

---

## A0：登录与权限（必须先做）

### A0-01：Supabase OAuth 登录 `/admin/login`（P0）

**允许改动（白名单）**
- `app/**`
- `components/**`
- `lib/**`
- `actions/**`（若存在）
- `public/**`（仅新增静态资源）
- `docs/**`

**禁止改动（黑名单）**
- 不更换 UI 组件库/主题体系（shadcn/tailwind 保持不变）
- 不进行大规模重构（除非工单明确允许）
- 不提交 `.env*`、不把任何密钥写入仓库
- 不改动与本工单无关的管理端导航/信息架构
- 不升级依赖大版本（除非工单明确要求）

**需要我手动操作时请写进 docs**
- 若需要我在 Supabase 控制台/SQL Editor/Authentication 设置里手动操作，请在 `docs/project-status.md`（或本项目 `docs/` 下新建同名文件）写清楚：入口路径、点击顺序、要粘贴的 SQL、预期看到的结果截图点位。

**交付要求**
- 先输出：计划（步骤）+ 将新增/修改的文件清单 + 每个文件将写入的关键内容摘要（或关键片段）。
- 我确认后再写入文件。
- 完成后给：验收步骤 + 建议 commit message。

**验收**：能登录、登出、会话保持

### A0-02：profiles 表 + trigger + RLS（P0）

**允许改动（白名单）**
- `app/**`
- `components/**`
- `lib/**`
- `actions/**`（若存在）
- `public/**`（仅新增静态资源）
- `docs/**`

**禁止改动（黑名单）**
- 不更换 UI 组件库/主题体系（shadcn/tailwind 保持不变）
- 不进行大规模重构（除非工单明确允许）
- 不提交 `.env*`、不把任何密钥写入仓库
- 不改动与本工单无关的管理端导航/信息架构
- 不升级依赖大版本（除非工单明确要求）

**需要我手动操作时请写进 docs**
- 若需要我在 Supabase 控制台/SQL Editor/Authentication 设置里手动操作，请在 `docs/project-status.md`（或本项目 `docs/` 下新建同名文件）写清楚：入口路径、点击顺序、要粘贴的 SQL、预期看到的结果截图点位。

**交付要求**
- 先输出：计划（步骤）+ 将新增/修改的文件清单 + 每个文件将写入的关键内容摘要（或关键片段）。
- 我确认后再写入文件。
- 完成后给：验收步骤 + 建议 commit message。

**验收**：新用户自动生成 profile；role 默认 viewer；admin 可管理所有

### A0-03：Admin 路由保护 `/admin/*` + 403（P0）

**允许改动（白名单）**
- `app/**`
- `components/**`
- `lib/**`
- `actions/**`（若存在）
- `public/**`（仅新增静态资源）
- `docs/**`

**禁止改动（黑名单）**
- 不更换 UI 组件库/主题体系（shadcn/tailwind 保持不变）
- 不进行大规模重构（除非工单明确允许）
- 不提交 `.env*`、不把任何密钥写入仓库
- 不改动与本工单无关的管理端导航/信息架构
- 不升级依赖大版本（除非工单明确要求）

**需要我手动操作时请写进 docs**
- 若需要我在 Supabase 控制台/SQL Editor/Authentication 设置里手动操作，请在 `docs/project-status.md`（或本项目 `docs/` 下新建同名文件）写清楚：入口路径、点击顺序、要粘贴的 SQL、预期看到的结果截图点位。

**交付要求**
- 先输出：计划（步骤）+ 将新增/修改的文件清单 + 每个文件将写入的关键内容摘要（或关键片段）。
- 我确认后再写入文件。
- 完成后给：验收步骤 + 建议 commit message。

**验收**：未登录跳转；无权限 403

---

## A1：内容契约与数据库（核心）

### A1-01：建立 `content_items` 表（P0）

**允许改动（白名单）**
- `app/**`
- `components/**`
- `lib/**`
- `actions/**`（若存在）
- `public/**`（仅新增静态资源）
- `docs/**`

**禁止改动（黑名单）**
- 不更换 UI 组件库/主题体系（shadcn/tailwind 保持不变）
- 不进行大规模重构（除非工单明确允许）
- 不提交 `.env*`、不把任何密钥写入仓库
- 不改动与本工单无关的管理端导航/信息架构
- 不升级依赖大版本（除非工单明确要求）

**需要我手动操作时请写进 docs**
- 若需要我在 Supabase 控制台/SQL Editor/Authentication 设置里手动操作，请在 `docs/project-status.md`（或本项目 `docs/` 下新建同名文件）写清楚：入口路径、点击顺序、要粘贴的 SQL、预期看到的结果截图点位。

**交付要求**
- 先输出：计划（步骤）+ 将新增/修改的文件清单 + 每个文件将写入的关键内容摘要（或关键片段）。
- 我确认后再写入文件。
- 完成后给：验收步骤 + 建议 commit message。

**目标**：统一承载所有内容类型  
**字段**：type/slug/locale/status/content_json/seo_json/geo_json  
**RLS**：
- read：viewer/editor/admin（管理端）  
- write：editor/admin  
- publish/archived：仅 admin（可通过应用层限制 + policy 进一步收紧）  
**验收**：表存在，RLS 生效

### A1-02：内容类型枚举与校验（P0）

**允许改动（白名单）**
- `app/**`
- `components/**`
- `lib/**`
- `actions/**`（若存在）
- `public/**`（仅新增静态资源）
- `docs/**`

**禁止改动（黑名单）**
- 不更换 UI 组件库/主题体系（shadcn/tailwind 保持不变）
- 不进行大规模重构（除非工单明确允许）
- 不提交 `.env*`、不把任何密钥写入仓库
- 不改动与本工单无关的管理端导航/信息架构
- 不升级依赖大版本（除非工单明确要求）

**需要我手动操作时请写进 docs**
- 若需要我在 Supabase 控制台/SQL Editor/Authentication 设置里手动操作，请在 `docs/project-status.md`（或本项目 `docs/` 下新建同名文件）写清楚：入口路径、点击顺序、要粘贴的 SQL、预期看到的结果截图点位。

**交付要求**
- 先输出：计划（步骤）+ 将新增/修改的文件清单 + 每个文件将写入的关键内容摘要（或关键片段）。
- 我确认后再写入文件。
- 完成后给：验收步骤 + 建议 commit message。

**目标**：避免随意 type，保证 Web 可消费  
**验收**：插入非法 type 被拒绝或被应用层拦截

### A1-03：审计表 `content_audit_log`（P0）

**允许改动（白名单）**
- `app/**`
- `components/**`
- `lib/**`
- `actions/**`（若存在）
- `public/**`（仅新增静态资源）
- `docs/**`

**禁止改动（黑名单）**
- 不更换 UI 组件库/主题体系（shadcn/tailwind 保持不变）
- 不进行大规模重构（除非工单明确允许）
- 不提交 `.env*`、不把任何密钥写入仓库
- 不改动与本工单无关的管理端导航/信息架构
- 不升级依赖大版本（除非工单明确要求）

**需要我手动操作时请写进 docs**
- 若需要我在 Supabase 控制台/SQL Editor/Authentication 设置里手动操作，请在 `docs/project-status.md`（或本项目 `docs/` 下新建同名文件）写清楚：入口路径、点击顺序、要粘贴的 SQL、预期看到的结果截图点位。

**交付要求**
- 先输出：计划（步骤）+ 将新增/修改的文件清单 + 每个文件将写入的关键内容摘要（或关键片段）。
- 我确认后再写入文件。
- 完成后给：验收步骤 + 建议 commit message。

**目标**：记录 publish/unpublish/edit  
**字段**：content_id, action, actor, diff(optional), created_at  
**验收**：发布动作必写一条 log

---

## A2：内容工作台（按类型逐个闭环）

> 每个类型都必须做：列表 → 新增 → 编辑 → 预览 → 发布/下架 → 与 Web 对齐验收。

### A2-01：医疗词汇（medical_lexicon）工作台（P0）

**允许改动（白名单）**
- `app/**`
- `components/**`
- `lib/**`
- `actions/**`（若存在）
- `public/**`（仅新增静态资源）
- `docs/**`

**禁止改动（黑名单）**
- 不更换 UI 组件库/主题体系（shadcn/tailwind 保持不变）
- 不进行大规模重构（除非工单明确允许）
- 不提交 `.env*`、不把任何密钥写入仓库
- 不改动与本工单无关的管理端导航/信息架构
- 不升级依赖大版本（除非工单明确要求）

**需要我手动操作时请写进 docs**
- 若需要我在 Supabase 控制台/SQL Editor/Authentication 设置里手动操作，请在 `docs/project-status.md`（或本项目 `docs/` 下新建同名文件）写清楚：入口路径、点击顺序、要粘贴的 SQL、预期看到的结果截图点位。

**交付要求**
- 先输出：计划（步骤）+ 将新增/修改的文件清单 + 每个文件将写入的关键内容摘要（或关键片段）。
- 我确认后再写入文件。
- 完成后给：验收步骤 + 建议 commit message。

**Admin 页面**：list + editor + publish  
**数据**：写入 content_items(type='medical_lexicon')  
**验收（跨端）**：发布后 Web 的医疗词汇列表/详情能读到

### A2-02：医疗场景（medical_scenario）工作台（P0）

**允许改动（白名单）**
- `app/**`
- `components/**`
- `lib/**`
- `actions/**`（若存在）
- `public/**`（仅新增静态资源）
- `docs/**`

**禁止改动（黑名单）**
- 不更换 UI 组件库/主题体系（shadcn/tailwind 保持不变）
- 不进行大规模重构（除非工单明确允许）
- 不提交 `.env*`、不把任何密钥写入仓库
- 不改动与本工单无关的管理端导航/信息架构
- 不升级依赖大版本（除非工单明确要求）

**需要我手动操作时请写进 docs**
- 若需要我在 Supabase 控制台/SQL Editor/Authentication 设置里手动操作，请在 `docs/project-status.md`（或本项目 `docs/` 下新建同名文件）写清楚：入口路径、点击顺序、要粘贴的 SQL、预期看到的结果截图点位。

**交付要求**
- 先输出：计划（步骤）+ 将新增/修改的文件清单 + 每个文件将写入的关键内容摘要（或关键片段）。
- 我确认后再写入文件。
- 完成后给：验收步骤 + 建议 commit message。

**验收（跨端）**：发布后 Web 场景列表/详情能读到

### A2-03：通用词典（lexicon）工作台（P0）

**允许改动（白名单）**
- `app/**`
- `components/**`
- `lib/**`
- `actions/**`（若存在）
- `public/**`（仅新增静态资源）
- `docs/**`

**禁止改动（黑名单）**
- 不更换 UI 组件库/主题体系（shadcn/tailwind 保持不变）
- 不进行大规模重构（除非工单明确允许）
- 不提交 `.env*`、不把任何密钥写入仓库
- 不改动与本工单无关的管理端导航/信息架构
- 不升级依赖大版本（除非工单明确要求）

**需要我手动操作时请写进 docs**
- 若需要我在 Supabase 控制台/SQL Editor/Authentication 设置里手动操作，请在 `docs/project-status.md`（或本项目 `docs/` 下新建同名文件）写清楚：入口路径、点击顺序、要粘贴的 SQL、预期看到的结果截图点位。

**交付要求**
- 先输出：计划（步骤）+ 将新增/修改的文件清单 + 每个文件将写入的关键内容摘要（或关键片段）。
- 我确认后再写入文件。
- 完成后给：验收步骤 + 建议 commit message。

**验收**：发布后 Web dictionary 能读到

### A2-04：Grammar 工作台（P0）

**允许改动（白名单）**
- `app/**`
- `components/**`
- `lib/**`
- `actions/**`（若存在）
- `public/**`（仅新增静态资源）
- `docs/**`

**禁止改动（黑名单）**
- 不更换 UI 组件库/主题体系（shadcn/tailwind 保持不变）
- 不进行大规模重构（除非工单明确允许）
- 不提交 `.env*`、不把任何密钥写入仓库
- 不改动与本工单无关的管理端导航/信息架构
- 不升级依赖大版本（除非工单明确要求）

**需要我手动操作时请写进 docs**
- 若需要我在 Supabase 控制台/SQL Editor/Authentication 设置里手动操作，请在 `docs/project-status.md`（或本项目 `docs/` 下新建同名文件）写清楚：入口路径、点击顺序、要粘贴的 SQL、预期看到的结果截图点位。

**交付要求**
- 先输出：计划（步骤）+ 将新增/修改的文件清单 + 每个文件将写入的关键内容摘要（或关键片段）。
- 我确认后再写入文件。
- 完成后给：验收步骤 + 建议 commit message。

**验收**：发布后 Web grammar 详情可读

### A2-05：Readings 工作台（P0）

**允许改动（白名单）**
- `app/**`
- `components/**`
- `lib/**`
- `actions/**`（若存在）
- `public/**`（仅新增静态资源）
- `docs/**`

**禁止改动（黑名单）**
- 不更换 UI 组件库/主题体系（shadcn/tailwind 保持不变）
- 不进行大规模重构（除非工单明确允许）
- 不提交 `.env*`、不把任何密钥写入仓库
- 不改动与本工单无关的管理端导航/信息架构
- 不升级依赖大版本（除非工单明确要求）

**需要我手动操作时请写进 docs**
- 若需要我在 Supabase 控制台/SQL Editor/Authentication 设置里手动操作，请在 `docs/project-status.md`（或本项目 `docs/` 下新建同名文件）写清楚：入口路径、点击顺序、要粘贴的 SQL、预期看到的结果截图点位。

**交付要求**
- 先输出：计划（步骤）+ 将新增/修改的文件清单 + 每个文件将写入的关键内容摘要（或关键片段）。
- 我确认后再写入文件。
- 完成后给：验收步骤 + 建议 commit message。

**验收**：发布后 Web reader 可读

### A2-06：Lessons 工作台（P0）

**允许改动（白名单）**
- `app/**`
- `components/**`
- `lib/**`
- `actions/**`（若存在）
- `public/**`（仅新增静态资源）
- `docs/**`

**禁止改动（黑名单）**
- 不更换 UI 组件库/主题体系（shadcn/tailwind 保持不变）
- 不进行大规模重构（除非工单明确允许）
- 不提交 `.env*`、不把任何密钥写入仓库
- 不改动与本工单无关的管理端导航/信息架构
- 不升级依赖大版本（除非工单明确要求）

**需要我手动操作时请写进 docs**
- 若需要我在 Supabase 控制台/SQL Editor/Authentication 设置里手动操作，请在 `docs/project-status.md`（或本项目 `docs/` 下新建同名文件）写清楚：入口路径、点击顺序、要粘贴的 SQL、预期看到的结果截图点位。

**交付要求**
- 先输出：计划（步骤）+ 将新增/修改的文件清单 + 每个文件将写入的关键内容摘要（或关键片段）。
- 我确认后再写入文件。
- 完成后给：验收步骤 + 建议 commit message。

**验收**：发布后 Web lessons 可读

### A2-07：医疗对话/文章（medical_dialog）工作台（P1）

**允许改动（白名单）**
- `app/**`
- `components/**`
- `lib/**`
- `actions/**`（若存在）
- `public/**`（仅新增静态资源）
- `docs/**`

**禁止改动（黑名单）**
- 不更换 UI 组件库/主题体系（shadcn/tailwind 保持不变）
- 不进行大规模重构（除非工单明确允许）
- 不提交 `.env*`、不把任何密钥写入仓库
- 不改动与本工单无关的管理端导航/信息架构
- 不升级依赖大版本（除非工单明确要求）

**需要我手动操作时请写进 docs**
- 若需要我在 Supabase 控制台/SQL Editor/Authentication 设置里手动操作，请在 `docs/project-status.md`（或本项目 `docs/` 下新建同名文件）写清楚：入口路径、点击顺序、要粘贴的 SQL、预期看到的结果截图点位。

**交付要求**
- 先输出：计划（步骤）+ 将新增/修改的文件清单 + 每个文件将写入的关键内容摘要（或关键片段）。
- 我确认后再写入文件。
- 完成后给：验收步骤 + 建议 commit message。

**验收**：专题页可读；SEO 字段可用

### A2-08：医疗语法（medical_grammar）工作台（P1）

**允许改动（白名单）**
- `app/**`
- `components/**`
- `lib/**`
- `actions/**`（若存在）
- `public/**`（仅新增静态资源）
- `docs/**`

**禁止改动（黑名单）**
- 不更换 UI 组件库/主题体系（shadcn/tailwind 保持不变）
- 不进行大规模重构（除非工单明确允许）
- 不提交 `.env*`、不把任何密钥写入仓库
- 不改动与本工单无关的管理端导航/信息架构
- 不升级依赖大版本（除非工单明确要求）

**需要我手动操作时请写进 docs**
- 若需要我在 Supabase 控制台/SQL Editor/Authentication 设置里手动操作，请在 `docs/project-status.md`（或本项目 `docs/` 下新建同名文件）写清楚：入口路径、点击顺序、要粘贴的 SQL、预期看到的结果截图点位。

**交付要求**
- 先输出：计划（步骤）+ 将新增/修改的文件清单 + 每个文件将写入的关键内容摘要（或关键片段）。
- 我确认后再写入文件。
- 完成后给：验收步骤 + 建议 commit message。


---

## A3：SEO 工作台（必须）

### A3-01：SEO 字段编辑器组件（P0）

**允许改动（白名单）**
- `app/**`
- `components/**`
- `lib/**`
- `actions/**`（若存在）
- `public/**`（仅新增静态资源）
- `docs/**`

**禁止改动（黑名单）**
- 不更换 UI 组件库/主题体系（shadcn/tailwind 保持不变）
- 不进行大规模重构（除非工单明确允许）
- 不提交 `.env*`、不把任何密钥写入仓库
- 不改动与本工单无关的管理端导航/信息架构
- 不升级依赖大版本（除非工单明确要求）

**需要我手动操作时请写进 docs**
- 若需要我在 Supabase 控制台/SQL Editor/Authentication 设置里手动操作，请在 `docs/project-status.md`（或本项目 `docs/` 下新建同名文件）写清楚：入口路径、点击顺序、要粘贴的 SQL、预期看到的结果截图点位。

**交付要求**
- 先输出：计划（步骤）+ 将新增/修改的文件清单 + 每个文件将写入的关键内容摘要（或关键片段）。
- 我确认后再写入文件。
- 完成后给：验收步骤 + 建议 commit message。

**字段**：title/description/canonical/og/faq  
**验收**：保存后写入 seo_json；Web 能读取用于 head/schema

### A3-02：SEO 预览（P0）

**允许改动（白名单）**
- `app/**`
- `components/**`
- `lib/**`
- `actions/**`（若存在）
- `public/**`（仅新增静态资源）
- `docs/**`

**禁止改动（黑名单）**
- 不更换 UI 组件库/主题体系（shadcn/tailwind 保持不变）
- 不进行大规模重构（除非工单明确允许）
- 不提交 `.env*`、不把任何密钥写入仓库
- 不改动与本工单无关的管理端导航/信息架构
- 不升级依赖大版本（除非工单明确要求）

**需要我手动操作时请写进 docs**
- 若需要我在 Supabase 控制台/SQL Editor/Authentication 设置里手动操作，请在 `docs/project-status.md`（或本项目 `docs/` 下新建同名文件）写清楚：入口路径、点击顺序、要粘贴的 SQL、预期看到的结果截图点位。

**交付要求**
- 先输出：计划（步骤）+ 将新增/修改的文件清单 + 每个文件将写入的关键内容摘要（或关键片段）。
- 我确认后再写入文件。
- 完成后给：验收步骤 + 建议 commit message。

**目标**：预览 SERP 样式 + OG 卡片  
**验收**：预览与实际字段一致

### A3-03：结构化数据模板（P1）

**允许改动（白名单）**
- `app/**`
- `components/**`
- `lib/**`
- `actions/**`（若存在）
- `public/**`（仅新增静态资源）
- `docs/**`

**禁止改动（黑名单）**
- 不更换 UI 组件库/主题体系（shadcn/tailwind 保持不变）
- 不进行大规模重构（除非工单明确允许）
- 不提交 `.env*`、不把任何密钥写入仓库
- 不改动与本工单无关的管理端导航/信息架构
- 不升级依赖大版本（除非工单明确要求）

**需要我手动操作时请写进 docs**
- 若需要我在 Supabase 控制台/SQL Editor/Authentication 设置里手动操作，请在 `docs/project-status.md`（或本项目 `docs/` 下新建同名文件）写清楚：入口路径、点击顺序、要粘贴的 SQL、预期看到的结果截图点位。

**交付要求**
- 先输出：计划（步骤）+ 将新增/修改的文件清单 + 每个文件将写入的关键内容摘要（或关键片段）。
- 我确认后再写入文件。
- 完成后给：验收步骤 + 建议 commit message。

**目标**：按 type 生成建议 schema（FAQ/Article/DefinedTerm）并可编辑  
**验收**：seo_json 中 schema 字段稳定

---

## A4：GEO 工作台（可选但建议）

### A4-01：geo_json 编辑器（P0/P1）

**允许改动（白名单）**
- `app/**`
- `components/**`
- `lib/**`
- `actions/**`（若存在）
- `public/**`（仅新增静态资源）
- `docs/**`

**禁止改动（黑名单）**
- 不更换 UI 组件库/主题体系（shadcn/tailwind 保持不变）
- 不进行大规模重构（除非工单明确允许）
- 不提交 `.env*`、不把任何密钥写入仓库
- 不改动与本工单无关的管理端导航/信息架构
- 不升级依赖大版本（除非工单明确要求）

**需要我手动操作时请写进 docs**
- 若需要我在 Supabase 控制台/SQL Editor/Authentication 设置里手动操作，请在 `docs/project-status.md`（或本项目 `docs/` 下新建同名文件）写清楚：入口路径、点击顺序、要粘贴的 SQL、预期看到的结果截图点位。

**交付要求**
- 先输出：计划（步骤）+ 将新增/修改的文件清单 + 每个文件将写入的关键内容摘要（或关键片段）。
- 我确认后再写入文件。
- 完成后给：验收步骤 + 建议 commit message。

**目标**：地区绑定、免责声明、城市标签  
**验收**：写入 geo_json；Web 可用于 GEO 页面聚合

---

## A5：发布中心（批量发布 + 变更记录）

### A5-01：发布中心列表（P0）

**允许改动（白名单）**
- `app/**`
- `components/**`
- `lib/**`
- `actions/**`（若存在）
- `public/**`（仅新增静态资源）
- `docs/**`

**禁止改动（黑名单）**
- 不更换 UI 组件库/主题体系（shadcn/tailwind 保持不变）
- 不进行大规模重构（除非工单明确允许）
- 不提交 `.env*`、不把任何密钥写入仓库
- 不改动与本工单无关的管理端导航/信息架构
- 不升级依赖大版本（除非工单明确要求）

**需要我手动操作时请写进 docs**
- 若需要我在 Supabase 控制台/SQL Editor/Authentication 设置里手动操作，请在 `docs/project-status.md`（或本项目 `docs/` 下新建同名文件）写清楚：入口路径、点击顺序、要粘贴的 SQL、预期看到的结果截图点位。

**交付要求**
- 先输出：计划（步骤）+ 将新增/修改的文件清单 + 每个文件将写入的关键内容摘要（或关键片段）。
- 我确认后再写入文件。
- 完成后给：验收步骤 + 建议 commit message。

**目标**：按筛选条件看到 draft/review/published  
**验收**：可按 status/locale/type 筛选

### A5-02：批量发布（P0）

**允许改动（白名单）**
- `app/**`
- `components/**`
- `lib/**`
- `actions/**`（若存在）
- `public/**`（仅新增静态资源）
- `docs/**`

**禁止改动（黑名单）**
- 不更换 UI 组件库/主题体系（shadcn/tailwind 保持不变）
- 不进行大规模重构（除非工单明确允许）
- 不提交 `.env*`、不把任何密钥写入仓库
- 不改动与本工单无关的管理端导航/信息架构
- 不升级依赖大版本（除非工单明确要求）

**需要我手动操作时请写进 docs**
- 若需要我在 Supabase 控制台/SQL Editor/Authentication 设置里手动操作，请在 `docs/project-status.md`（或本项目 `docs/` 下新建同名文件）写清楚：入口路径、点击顺序、要粘贴的 SQL、预期看到的结果截图点位。

**交付要求**
- 先输出：计划（步骤）+ 将新增/修改的文件清单 + 每个文件将写入的关键内容摘要（或关键片段）。
- 我确认后再写入文件。
- 完成后给：验收步骤 + 建议 commit message。

**目标**：选中多条 → 一键 publish（仅 admin）  
**验收**：批量发布成功后 audit log 有记录

### A5-03：变更记录查看（P0）

**允许改动（白名单）**
- `app/**`
- `components/**`
- `lib/**`
- `actions/**`（若存在）
- `public/**`（仅新增静态资源）
- `docs/**`

**禁止改动（黑名单）**
- 不更换 UI 组件库/主题体系（shadcn/tailwind 保持不变）
- 不进行大规模重构（除非工单明确允许）
- 不提交 `.env*`、不把任何密钥写入仓库
- 不改动与本工单无关的管理端导航/信息架构
- 不升级依赖大版本（除非工单明确要求）

**需要我手动操作时请写进 docs**
- 若需要我在 Supabase 控制台/SQL Editor/Authentication 设置里手动操作，请在 `docs/project-status.md`（或本项目 `docs/` 下新建同名文件）写清楚：入口路径、点击顺序、要粘贴的 SQL、预期看到的结果截图点位。

**交付要求**
- 先输出：计划（步骤）+ 将新增/修改的文件清单 + 每个文件将写入的关键内容摘要（或关键片段）。
- 我确认后再写入文件。
- 完成后给：验收步骤 + 建议 commit message。

**目标**：按 content_id 查看发布历史  
**验收**：每次 publish 都能追溯

### A5-04：版本回滚（P2）

**允许改动（白名单）**
- `app/**`
- `components/**`
- `lib/**`
- `actions/**`（若存在）
- `public/**`（仅新增静态资源）
- `docs/**`

**禁止改动（黑名单）**
- 不更换 UI 组件库/主题体系（shadcn/tailwind 保持不变）
- 不进行大规模重构（除非工单明确允许）
- 不提交 `.env*`、不把任何密钥写入仓库
- 不改动与本工单无关的管理端导航/信息架构
- 不升级依赖大版本（除非工单明确要求）

**需要我手动操作时请写进 docs**
- 若需要我在 Supabase 控制台/SQL Editor/Authentication 设置里手动操作，请在 `docs/project-status.md`（或本项目 `docs/` 下新建同名文件）写清楚：入口路径、点击顺序、要粘贴的 SQL、预期看到的结果截图点位。

**交付要求**
- 先输出：计划（步骤）+ 将新增/修改的文件清单 + 每个文件将写入的关键内容摘要（或关键片段）。
- 我确认后再写入文件。
- 完成后给：验收步骤 + 建议 commit message。

**依赖**：版本表 `content_versions`  
**验收**：可回到上一个 published 版本

---

## A6：素材库（P1）

### A6-01：Supabase Storage 配置（P1）

**允许改动（白名单）**
- `app/**`
- `components/**`
- `lib/**`
- `actions/**`（若存在）
- `public/**`（仅新增静态资源）
- `docs/**`

**禁止改动（黑名单）**
- 不更换 UI 组件库/主题体系（shadcn/tailwind 保持不变）
- 不进行大规模重构（除非工单明确允许）
- 不提交 `.env*`、不把任何密钥写入仓库
- 不改动与本工单无关的管理端导航/信息架构
- 不升级依赖大版本（除非工单明确要求）

**需要我手动操作时请写进 docs**
- 若需要我在 Supabase 控制台/SQL Editor/Authentication 设置里手动操作，请在 `docs/project-status.md`（或本项目 `docs/` 下新建同名文件）写清楚：入口路径、点击顺序、要粘贴的 SQL、预期看到的结果截图点位。

**交付要求**
- 先输出：计划（步骤）+ 将新增/修改的文件清单 + 每个文件将写入的关键内容摘要（或关键片段）。
- 我确认后再写入文件。
- 完成后给：验收步骤 + 建议 commit message。

**验收**：可上传图片并返回 URL

### A6-02：素材管理页面（P1）

**允许改动（白名单）**
- `app/**`
- `components/**`
- `lib/**`
- `actions/**`（若存在）
- `public/**`（仅新增静态资源）
- `docs/**`

**禁止改动（黑名单）**
- 不更换 UI 组件库/主题体系（shadcn/tailwind 保持不变）
- 不进行大规模重构（除非工单明确允许）
- 不提交 `.env*`、不把任何密钥写入仓库
- 不改动与本工单无关的管理端导航/信息架构
- 不升级依赖大版本（除非工单明确要求）

**需要我手动操作时请写进 docs**
- 若需要我在 Supabase 控制台/SQL Editor/Authentication 设置里手动操作，请在 `docs/project-status.md`（或本项目 `docs/` 下新建同名文件）写清楚：入口路径、点击顺序、要粘贴的 SQL、预期看到的结果截图点位。

**交付要求**
- 先输出：计划（步骤）+ 将新增/修改的文件清单 + 每个文件将写入的关键内容摘要（或关键片段）。
- 我确认后再写入文件。
- 完成后给：验收步骤 + 建议 commit message。

**验收**：可浏览、删除（权限控制）、复制链接

---

## A7：用户与角色管理（P1）

### A7-01：profiles 管理页面（P1）

**允许改动（白名单）**
- `app/**`
- `components/**`
- `lib/**`
- `actions/**`（若存在）
- `public/**`（仅新增静态资源）
- `docs/**`

**禁止改动（黑名单）**
- 不更换 UI 组件库/主题体系（shadcn/tailwind 保持不变）
- 不进行大规模重构（除非工单明确允许）
- 不提交 `.env*`、不把任何密钥写入仓库
- 不改动与本工单无关的管理端导航/信息架构
- 不升级依赖大版本（除非工单明确要求）

**需要我手动操作时请写进 docs**
- 若需要我在 Supabase 控制台/SQL Editor/Authentication 设置里手动操作，请在 `docs/project-status.md`（或本项目 `docs/` 下新建同名文件）写清楚：入口路径、点击顺序、要粘贴的 SQL、预期看到的结果截图点位。

**交付要求**
- 先输出：计划（步骤）+ 将新增/修改的文件清单 + 每个文件将写入的关键内容摘要（或关键片段）。
- 我确认后再写入文件。
- 完成后给：验收步骤 + 建议 commit message。

**功能**：搜索用户、修改 role  
**验收**：修改 role 立即影响权限

### A7-02：allowlist（可选）（P1）

**允许改动（白名单）**
- `app/**`
- `components/**`
- `lib/**`
- `actions/**`（若存在）
- `public/**`（仅新增静态资源）
- `docs/**`

**禁止改动（黑名单）**
- 不更换 UI 组件库/主题体系（shadcn/tailwind 保持不变）
- 不进行大规模重构（除非工单明确允许）
- 不提交 `.env*`、不把任何密钥写入仓库
- 不改动与本工单无关的管理端导航/信息架构
- 不升级依赖大版本（除非工单明确要求）

**需要我手动操作时请写进 docs**
- 若需要我在 Supabase 控制台/SQL Editor/Authentication 设置里手动操作，请在 `docs/project-status.md`（或本项目 `docs/` 下新建同名文件）写清楚：入口路径、点击顺序、要粘贴的 SQL、预期看到的结果截图点位。

**交付要求**
- 先输出：计划（步骤）+ 将新增/修改的文件清单 + 每个文件将写入的关键内容摘要（或关键片段）。
- 我确认后再写入文件。
- 完成后给：验收步骤 + 建议 commit message。

**验收**：非 allowlist 用户无法进入 Admin（若启用）

---

## A8：上线前 QA（P0）

### A8-01：RLS 与权限回归（P0）

**允许改动（白名单）**
- `app/**`
- `components/**`
- `lib/**`
- `actions/**`（若存在）
- `public/**`（仅新增静态资源）
- `docs/**`

**禁止改动（黑名单）**
- 不更换 UI 组件库/主题体系（shadcn/tailwind 保持不变）
- 不进行大规模重构（除非工单明确允许）
- 不提交 `.env*`、不把任何密钥写入仓库
- 不改动与本工单无关的管理端导航/信息架构
- 不升级依赖大版本（除非工单明确要求）

**需要我手动操作时请写进 docs**
- 若需要我在 Supabase 控制台/SQL Editor/Authentication 设置里手动操作，请在 `docs/project-status.md`（或本项目 `docs/` 下新建同名文件）写清楚：入口路径、点击顺序、要粘贴的 SQL、预期看到的结果截图点位。

**交付要求**
- 先输出：计划（步骤）+ 将新增/修改的文件清单 + 每个文件将写入的关键内容摘要（或关键片段）。
- 我确认后再写入文件。
- 完成后给：验收步骤 + 建议 commit message。

**验收**：viewer 无法写；editor 无法发布（若你限制）；admin 全部可

### A8-02：跨端验收脚本（P0）

**允许改动（白名单）**
- `app/**`
- `components/**`
- `lib/**`
- `actions/**`（若存在）
- `public/**`（仅新增静态资源）
- `docs/**`

**禁止改动（黑名单）**
- 不更换 UI 组件库/主题体系（shadcn/tailwind 保持不变）
- 不进行大规模重构（除非工单明确允许）
- 不提交 `.env*`、不把任何密钥写入仓库
- 不改动与本工单无关的管理端导航/信息架构
- 不升级依赖大版本（除非工单明确要求）

**需要我手动操作时请写进 docs**
- 若需要我在 Supabase 控制台/SQL Editor/Authentication 设置里手动操作，请在 `docs/project-status.md`（或本项目 `docs/` 下新建同名文件）写清楚：入口路径、点击顺序、要粘贴的 SQL、预期看到的结果截图点位。

**交付要求**
- 先输出：计划（步骤）+ 将新增/修改的文件清单 + 每个文件将写入的关键内容摘要（或关键片段）。
- 我确认后再写入文件。
- 完成后给：验收步骤 + 建议 commit message。

**验收**：每个 type 发布后 Web 列表/详情都可见且 SEO 元信息正确
